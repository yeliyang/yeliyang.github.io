<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="ç†è®ºåŸºç¡€å¤šå±‚æ„ŸçŸ¥æœºåœ¨å•å±‚ç¥ç»ç½‘ç»œçš„åŸºç¡€ä¸Šå¼•å…¥äº†ä¸€åˆ°å¤šä¸ªéšè—å±‚ï¼ˆhidden layerï¼‰ã€‚å…¨è¿æ¥å±‚åªæ˜¯å¯¹æ•°æ®åšä»¿å°„å˜æ¢ï¼ˆaffine transformationï¼‰ï¼Œè€Œå¤šä¸ªä»¿å°„å˜æ¢çš„å åŠ ä»ç„¶æ˜¯ä¸€ä¸ªä»¿å°„å˜æ¢ã€‚è§£å†³é—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯å¼•å…¥éçº¿æ€§å˜æ¢ï¼Œä¾‹å¦‚å¯¹éšè—å˜é‡ä½¿ç”¨æŒ‰å…ƒç´ è¿ç®—çš„éçº¿æ€§å‡½æ•°è¿›è¡Œå˜æ¢ï¼Œç„¶åå†ä½œ">
    

    <!--Author-->
    
        <meta name="author" content="Liyang Ye">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="å¤šå±‚æ„ŸçŸ¥æœº"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Liyang&#39;s Blog"/>

    <!--Page Cover-->
    
        <meta property="og:image" content=""/>
    

    <!-- Title -->
    
    <title>å¤šå±‚æ„ŸçŸ¥æœº - Liyang&#39;s Blog</title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/sass/main.css">


    <!--[if lt IE 8]>
        
<script src="/js/ie/html5shiv.js"></script>

    <![endif]-->

    <!--[if lt IE 8]>
        
<link rel="stylesheet" href="/sass/ie8.css">

    <![endif]-->

    <!--[if lt IE 9]>
        
<link rel="stylesheet" href="/sass/ie9.css">

    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.3.0"></head>

<body>

    <div id="wrapper">

        <!-- Menu -->
        <!-- Header -->
<header id="header">
    <div class="inner">

        <!-- Logo -->
        <a href="/" class="logo">
            <span class="symbol"><img src="/images/logo.svg" alt="" /></span><span class="title">Liyang's Blog</span>
        </a>

        <!-- Nav -->
        <nav>
            <ul>
                <li><a href="#menu">Menu</a></li>
            </ul>
        </nav>

    </div>
</header>

<!-- Menu -->
<nav id="menu">
    <h2>Menu</h2>
    <ul>
        
            <li>
                <a href="/">Home</a>
            </li>
        
            <li>
                <a href="/archives">Archives</a>
            </li>
        
            <li>
                <a href="/about.html">About</a>
            </li>
        
    </ul>
</nav>


        <div id="main">
            <div class="inner">

                <!-- Main Content -->
                

    <h1 class="title">å¤šå±‚æ„ŸçŸ¥æœº</h1>
    <div class="meta">
        2021-01-15
    </div>


    <span class="image main"><img src="/images/rnn_heros.jpg" alt="" /></span>


<!-- Gallery -->


<!-- Content -->
<h1 id="ç†è®ºåŸºç¡€"><a href="#ç†è®ºåŸºç¡€" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h1><p>å¤šå±‚æ„ŸçŸ¥æœºåœ¨å•å±‚ç¥ç»ç½‘ç»œçš„åŸºç¡€ä¸Šå¼•å…¥äº†ä¸€åˆ°å¤šä¸ª<strong>éšè—å±‚ï¼ˆhidden layerï¼‰</strong>ã€‚å…¨è¿æ¥å±‚åªæ˜¯å¯¹æ•°æ®åš<strong>ä»¿å°„å˜æ¢ï¼ˆaffine transformationï¼‰</strong>ï¼Œè€Œå¤šä¸ªä»¿å°„å˜æ¢çš„å åŠ ä»ç„¶æ˜¯ä¸€ä¸ªä»¿å°„å˜æ¢ã€‚è§£å†³é—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯å¼•å…¥<strong>éçº¿æ€§å˜æ¢</strong>ï¼Œä¾‹å¦‚å¯¹éšè—å˜é‡ä½¿ç”¨æŒ‰å…ƒç´ è¿ç®—çš„éçº¿æ€§å‡½æ•°è¿›è¡Œå˜æ¢ï¼Œç„¶åå†ä½œä¸ºä¸‹ä¸€ä¸ªå…¨è¿æ¥å±‚çš„è¾“å…¥ã€‚è¿™ä¸ªéçº¿æ€§å‡½æ•°è¢«ç§°ä¸º<strong>æ¿€æ´»å‡½æ•°ï¼ˆactivation functionï¼‰</strong>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> d2lzh <span class="keyword">as</span> d2l</span><br><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> autograd, nd</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xyplot</span>(<span class="params">x_vals, y_vals, name</span>):</span></span><br><span class="line">  <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  	plot x and y</span></span><br><span class="line"><span class="string">  &#x27;&#x27;&#x27;</span></span><br><span class="line">    d2l.set_figsize(figsize=(<span class="number">5</span>, <span class="number">2.5</span>))</span><br><span class="line">    d2l.plt.plot(x_vals.asnumpy(), y_vals.asnumpy())</span><br><span class="line">    d2l.plt.xlabel(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    d2l.plt.ylabel(name + <span class="string">&#x27;(x)&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="æ¿€æ´»å‡½æ•°"><a href="#æ¿€æ´»å‡½æ•°" class="headerlink" title="æ¿€æ´»å‡½æ•°"></a>æ¿€æ´»å‡½æ•°</h2><h4 id="ReLUå‡½æ•°"><a href="#ReLUå‡½æ•°" class="headerlink" title="ReLUå‡½æ•°"></a>ReLUå‡½æ•°</h4><p>ReLUå‡½æ•°<strong>åªä¿ç•™æ­£æ•°å…ƒç´ </strong>ï¼Œå¹¶å°†è´Ÿæ•°å…ƒç´ æ¸…é›¶</p>
<script type="math/tex; mode=display">
\text{ReLU}(x) = \max(x, 0)</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = nd.arange(-<span class="number">8.0</span>, <span class="number">8.0</span>, <span class="number">0.1</span>)</span><br><span class="line">x.attach_grad()</span><br><span class="line"><span class="keyword">with</span> autograd.record():</span><br><span class="line">    y = x.relu()</span><br><span class="line">xyplot(x, y, <span class="string">&#x27;relu&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/output_3_0.svg" alt="svg"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y.backward()</span><br><span class="line">xyplot(x, x.grad, <span class="string">&#x27;grad of relu&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/output_5_0.svg" alt="svg"></p>
<h4 id="sigmoidå‡½æ•°"><a href="#sigmoidå‡½æ•°" class="headerlink" title="sigmoidå‡½æ•°"></a>sigmoidå‡½æ•°</h4><p>sigmoidå‡½æ•°å¯ä»¥<strong>å°†å…ƒç´ çš„å€¼å˜æ¢åˆ°0å’Œ1ä¹‹é—´</strong>ï¼š</p>
<script type="math/tex; mode=display">
\text{sigmoid}(x) = \frac{1}{1 + \exp(-x)}</script><p>sigmoidå‡½æ•°åœ¨æ—©æœŸçš„ç¥ç»ç½‘ç»œä¸­è¾ƒä¸ºæ™®éï¼Œä½†å®ƒç›®å‰é€æ¸è¢«æ›´ç®€å•çš„ReLUå‡½æ•°å–ä»£ã€‚ä¸‹é¢ç»˜åˆ¶äº†sigmoidå‡½æ•°ã€‚å½“è¾“å…¥æ¥è¿‘0æ—¶ï¼Œsigmoidå‡½æ•°æ¥è¿‘çº¿æ€§å˜æ¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> autograd.record():</span><br><span class="line">    y = x.sigmoid()</span><br><span class="line">xyplot(x, y, <span class="string">&#x27;sigmoid&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/output_7_0.svg" alt="svg"></p>
<p>ä¾æ®é“¾å¼æ³•åˆ™ï¼Œsigmoidå‡½æ•°çš„å¯¼æ•°</p>
<script type="math/tex; mode=display">
\text{sigmoid}'(x) = \text{sigmoid}(x)\left(1-\text{sigmoid}(x)\right)</script><p>å½“è¾“å…¥ä¸º0æ—¶ï¼Œsigmoidå‡½æ•°çš„å¯¼æ•°è¾¾åˆ°æœ€å¤§å€¼0.25ï¼›å½“è¾“å…¥è¶Šåç¦»0æ—¶ï¼Œsigmoidå‡½æ•°çš„å¯¼æ•°è¶Šæ¥è¿‘0ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y.backward()</span><br><span class="line">xyplot(x, x.grad, <span class="string">&#x27;grad of sigmoid&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/output_9_0.svg" alt="svg"></p>
<h4 id="tanhå‡½æ•°"><a href="#tanhå‡½æ•°" class="headerlink" title="tanhå‡½æ•°"></a>tanhå‡½æ•°</h4><p>tanhï¼ˆåŒæ›²æ­£åˆ‡ï¼‰å‡½æ•°å¯ä»¥<strong>å°†å…ƒç´ çš„å€¼å˜æ¢åˆ°-1å’Œ1ä¹‹é—´</strong>ï¼š</p>
<script type="math/tex; mode=display">
\text{tanh}(x) = \frac{1 - \exp(-2x)}{1 + \exp(-2x)}</script><p>å½“è¾“å…¥æ¥è¿‘0æ—¶ï¼Œtanhå‡½æ•°æ¥è¿‘çº¿æ€§å˜æ¢ã€‚è™½ç„¶è¯¥å‡½æ•°çš„å½¢çŠ¶å’Œsigmoidå‡½æ•°çš„å½¢çŠ¶å¾ˆåƒï¼Œä½†tanhå‡½æ•°<strong>åœ¨åæ ‡ç³»çš„åŸç‚¹ä¸Šå¯¹ç§°</strong>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> autograd.record():</span><br><span class="line">    y = x.tanh()</span><br><span class="line">xyplot(x, y, <span class="string">&#x27;tanh&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/output_11_0.svg" alt="svg"></p>
<p>ä¾æ®é“¾å¼æ³•åˆ™ï¼Œtanhå‡½æ•°çš„å¯¼æ•°</p>
<script type="math/tex; mode=display">
\text{tanh}'(x) = 1 - \text{tanh}^2(x)</script><p>ä¸‹é¢ç»˜åˆ¶äº†tanhå‡½æ•°çš„å¯¼æ•°ã€‚å½“è¾“å…¥ä¸º0æ—¶ï¼Œtanhå‡½æ•°çš„å¯¼æ•°è¾¾åˆ°æœ€å¤§å€¼1ï¼›å½“è¾“å…¥è¶Šåç¦»0æ—¶ï¼Œtanhå‡½æ•°çš„å¯¼æ•°è¶Šæ¥è¿‘0ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y.backward()</span><br><span class="line">xyplot(x, x.grad, <span class="string">&#x27;grad of tanh&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/output_13_0.svg" alt="svg"></p>
<p>å¤šå±‚æ„ŸçŸ¥æœºå°±æ˜¯<strong>å«æœ‰è‡³å°‘ä¸€ä¸ªéšè—å±‚çš„ç”±å…¨è¿æ¥å±‚ç»„æˆçš„ç¥ç»ç½‘ç»œï¼Œä¸”æ¯ä¸ªéšè—å±‚çš„è¾“å‡ºé€šè¿‡æ¿€æ´»å‡½æ•°è¿›è¡Œå˜æ¢</strong>ã€‚å¤šå±‚æ„ŸçŸ¥æœºçš„å±‚æ•°å’Œå„éšè—å±‚ä¸­éšè—å•å…ƒä¸ªæ•°éƒ½æ˜¯è¶…å‚æ•°ã€‚ä»¥å•éšè—å±‚ä¸ºä¾‹å¹¶æ²¿ç”¨æœ¬èŠ‚ä¹‹å‰å®šä¹‰çš„ç¬¦å·ï¼Œå¤šå±‚æ„ŸçŸ¥æœºæŒ‰ä»¥ä¸‹æ–¹å¼è®¡ç®—è¾“å‡ºï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\boldsymbol{H} &= \phi(\boldsymbol{X} \boldsymbol{W}_h + \boldsymbol{b}_h)\\
\boldsymbol{O} &= \boldsymbol{H} \boldsymbol{W}_o + \boldsymbol{b}_o
\end{aligned}</script><p>å…¶ä¸­ğœ™è¡¨ç¤ºæ¿€æ´»å‡½æ•°ã€‚</p>
<script type="math/tex; mode=display">
\boldsymbol{O} = (\boldsymbol{X} \boldsymbol{W}_h + \boldsymbol{b}_h)\boldsymbol{W}_o + \boldsymbol{b}_o = \boldsymbol{X} \boldsymbol{W}_h\boldsymbol{W}_o + \boldsymbol{b}_h \boldsymbol{W}_o + \boldsymbol{b}_o</script><p>åœ¨<strong>åˆ†ç±»é—®é¢˜</strong>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥<strong>å¯¹è¾“å‡ºğ‘¶åšsoftmaxè¿ç®—</strong>ï¼Œå¹¶<strong>ä½¿ç”¨softmaxå›å½’ä¸­çš„äº¤å‰ç†µæŸå¤±å‡½æ•°</strong>ã€‚<br>åœ¨<strong>å›å½’é—®é¢˜</strong>ä¸­ï¼Œæˆ‘ä»¬<strong>å°†è¾“å‡ºå±‚çš„è¾“å‡ºä¸ªæ•°è®¾ä¸º1</strong>ï¼Œå¹¶å°†<strong>è¾“å‡ºğ‘¶ç›´æ¥æä¾›ç»™çº¿æ€§å›å½’ä¸­ä½¿ç”¨çš„å¹³æ–¹æŸå¤±å‡½æ•°</strong>ã€‚</p>
<h1 id="ä»£ç å®è·µ"><a href="#ä»£ç å®è·µ" class="headerlink" title="ä»£ç å®è·µ"></a>ä»£ç å®è·µ</h1><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥åŠ¨æ‰‹å®ç°ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºã€‚é¦–å…ˆå¯¼å…¥å®ç°æ‰€éœ€çš„åŒ…æˆ–æ¨¡å—ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> d2lzh <span class="keyword">as</span> d2l</span><br><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> nd</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> loss <span class="keyword">as</span> gloss</span><br></pre></td></tr></table></figure>
<h2 id="è·å–å’Œè¯»å–æ•°æ®"><a href="#è·å–å’Œè¯»å–æ•°æ®" class="headerlink" title="è·å–å’Œè¯»å–æ•°æ®"></a>è·å–å’Œè¯»å–æ•°æ®</h2><p>è¿™é‡Œç»§ç»­ä½¿ç”¨Fashion-MNISTæ•°æ®é›†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å¤šå±‚æ„ŸçŸ¥æœºå¯¹å›¾åƒè¿›è¡Œåˆ†ç±»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size)</span><br></pre></td></tr></table></figure>
<h2 id="å®šä¹‰æ¨¡å‹å‚æ•°"><a href="#å®šä¹‰æ¨¡å‹å‚æ•°" class="headerlink" title="å®šä¹‰æ¨¡å‹å‚æ•°"></a>å®šä¹‰æ¨¡å‹å‚æ•°</h2><p>Fashion-MNISTæ•°æ®é›†ä¸­å›¾åƒå½¢çŠ¶ä¸º28 X 28ï¼Œç±»åˆ«æ•°ä¸º10ã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬ä¾ç„¶ä½¿ç”¨é•¿åº¦ä¸º28 X 28 = 784çš„å‘é‡è¡¨ç¤ºæ¯ä¸€å¼ å›¾åƒã€‚å› æ­¤ï¼Œè¾“å…¥ä¸ªæ•°ä¸º784ï¼Œè¾“å‡ºä¸ªæ•°ä¸º10ã€‚å®éªŒä¸­ï¼Œæˆ‘ä»¬è®¾è¶…å‚æ•°éšè—å•å…ƒä¸ªæ•°ä¸º256ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">num_inputs, num_outputs, num_hiddens = <span class="number">784</span>, <span class="number">10</span>, <span class="number">12</span></span><br><span class="line"></span><br><span class="line">W1 = nd.random.normal(scale=<span class="number">0.01</span>, shape=(num_inputs, num_hiddens))</span><br><span class="line">b1 = nd.zeros(num_hiddens)</span><br><span class="line">W2 = nd.random.normal(scale=<span class="number">0.01</span>, shape=(num_hiddens, num_outputs))</span><br><span class="line">b2 = nd.zeros(num_outputs)</span><br><span class="line">params = [W1, b1, W2, b2]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">    param.attach_grad()</span><br></pre></td></tr></table></figure>
<h2 id="å®šä¹‰æ¿€æ´»å‡½æ•°"><a href="#å®šä¹‰æ¿€æ´»å‡½æ•°" class="headerlink" title="å®šä¹‰æ¿€æ´»å‡½æ•°"></a>å®šä¹‰æ¿€æ´»å‡½æ•°</h2><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åŸºç¡€çš„<code>maximum</code>å‡½æ•°æ¥å®ç°ReLUï¼Œè€Œéç›´æ¥è°ƒç”¨<code>relu</code>å‡½æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">relu</span>(<span class="params">X</span>):</span></span><br><span class="line">    <span class="keyword">return</span> nd.maximum(X, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h2 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h2><p>åŒsoftmaxå›å½’ä¸€æ ·ï¼Œæˆ‘ä»¬é€šè¿‡<code>reshape</code>å‡½æ•°å°†æ¯å¼ åŸå§‹å›¾åƒæ”¹æˆé•¿åº¦ä¸º<code>num_inputs</code>çš„å‘é‡ã€‚ç„¶åæˆ‘ä»¬å®ç°ä¸Šä¸€èŠ‚ä¸­å¤šå±‚æ„ŸçŸ¥æœºçš„è®¡ç®—è¡¨è¾¾å¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">net</span>(<span class="params">X</span>):</span></span><br><span class="line">    X = X.reshape((-<span class="number">1</span>, num_inputs)) <span class="comment">#28*28è½¬æˆ784*1</span></span><br><span class="line">    H = relu(nd.dot(X, W1) + b1) </span><br><span class="line">    <span class="keyword">return</span> nd.dot(H, W2) + b2</span><br></pre></td></tr></table></figure>
<h2 id="å®šä¹‰æŸå¤±å‡½æ•°"><a href="#å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h2><p>ä¸ºäº†å¾—åˆ°æ›´å¥½çš„æ•°å€¼ç¨³å®šæ€§ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨Gluonæä¾›çš„åŒ…æ‹¬softmaxè¿ç®—å’Œäº¤å‰ç†µæŸå¤±è®¡ç®—çš„å‡½æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss = gloss.SoftmaxCrossEntropyLoss()</span><br></pre></td></tr></table></figure>
<h2 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h2><p>æˆ‘ä»¬åœ¨è¿™é‡Œè®¾è¶…å‚æ•°è¿­ä»£å‘¨æœŸæ•°ä¸º5ï¼Œå­¦ä¹ ç‡ä¸º0.5ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">num_epochs, lr = <span class="number">5</span>, <span class="number">0.5</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_ch3</span>(<span class="params">net, train_iter, test_iter, loss, num_epochs, batch_size,</span></span></span><br><span class="line"><span class="function"><span class="params">              params=<span class="literal">None</span>, lr=<span class="literal">None</span>, trainer=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">        train_l_sum, train_acc_sum, n = <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> X, y <span class="keyword">in</span> train_iter:</span><br><span class="line">            <span class="comment">#è‡ªåŠ¨è®¡ç®—æ¢¯åº¦</span></span><br><span class="line">            <span class="keyword">with</span> autograd.record():</span><br><span class="line">                y_hat = net(X)</span><br><span class="line">                <span class="comment">#è®¡ç®—æŸå¤±å‡½æ•°</span></span><br><span class="line">                l = loss(y_hat, y).<span class="built_in">sum</span>()</span><br><span class="line">            <span class="comment">#læ±‚å¯¼</span></span><br><span class="line">            l.backward()</span><br><span class="line">            <span class="keyword">if</span> trainer <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                d2l.sgd(params, lr, batch_size)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#å‰å‘è¿ç®—</span></span><br><span class="line">                trainer.step(batch_size)  <span class="comment"># â€œsoftmaxå›å½’çš„ç®€æ´å®ç°â€ä¸€èŠ‚å°†ç”¨åˆ°</span></span><br><span class="line">            y = y.astype(<span class="string">&#x27;float32&#x27;</span>)</span><br><span class="line">            <span class="comment"># ç´¯ç§¯æŸå¤±å‡½æ•°</span></span><br><span class="line">            train_l_sum += l.asscalar()</span><br><span class="line">            <span class="comment"># ç´¯ç§¯å¾—åˆ†</span></span><br><span class="line">            train_acc_sum += (y_hat.argmax(axis=<span class="number">1</span>) == y).<span class="built_in">sum</span>().asscalar()</span><br><span class="line">            n += y.size</span><br><span class="line">        test_acc = evaluate_accuracy(test_iter, net)</span><br><span class="line">        print(<span class="string">&#x27;epoch %d, loss %.4f, train acc %.3f, test acc %.3f&#x27;</span></span><br><span class="line">              % (epoch + <span class="number">1</span>, train_l_sum / n, train_acc_sum / n, test_acc))</span><br><span class="line">        </span><br><span class="line">train_ch3(net, train_iter, test_iter, loss, num_epochs, batch_size,</span><br><span class="line">              params, lr)</span><br></pre></td></tr></table></figure>
<h2 id="ç®€ä»‹å®ç°"><a href="#ç®€ä»‹å®ç°" class="headerlink" title="ç®€ä»‹å®ç°"></a>ç®€ä»‹å®ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> d2lzh <span class="keyword">as</span> d2l</span><br><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> gluon, init</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> loss <span class="keyword">as</span> gloss, nn</span><br><span class="line"></span><br><span class="line">net = nn.Sequential()</span><br><span class="line">net.add(nn.Dense(<span class="number">256</span>, activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">        nn.Dense(<span class="number">10</span>))</span><br><span class="line">net.initialize(init.Normal(sigma=<span class="number">0.01</span>))</span><br><span class="line"></span><br><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size)</span><br><span class="line"></span><br><span class="line">loss = gloss.SoftmaxCrossEntropyLoss()</span><br><span class="line">trainer = gluon.Trainer(net.collect_params(), <span class="string">&#x27;sgd&#x27;</span>, &#123;<span class="string">&#x27;learning_rate&#x27;</span>: <span class="number">0.5</span>&#125;)</span><br><span class="line">num_epochs = <span class="number">5</span></span><br><span class="line">train_ch3(net, train_iter, test_iter, loss, num_epochs, batch_size, <span class="literal">None</span>, <span class="literal">None</span>, trainer)</span><br></pre></td></tr></table></figure>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ul>
<li>å¤šå±‚æ„ŸçŸ¥æœºåœ¨è¾“å‡ºå±‚ä¸è¾“å…¥å±‚ä¹‹é—´åŠ å…¥äº†ä¸€ä¸ªæˆ–å¤šä¸ªå…¨è¿æ¥éšè—å±‚ï¼Œå¹¶é€šè¿‡æ¿€æ´»å‡½æ•°å¯¹éšè—å±‚è¾“å‡ºè¿›è¡Œå˜æ¢ã€‚</li>
<li>å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°åŒ…æ‹¬ReLUå‡½æ•°ã€sigmoidå‡½æ•°å’Œtanhå‡½æ•°ã€‚</li>
<li>å¯ä»¥é€šè¿‡æ‰‹åŠ¨å®šä¹‰æ¨¡å‹åŠå…¶å‚æ•°æ¥å®ç°ç®€å•çš„å¤šå±‚æ„ŸçŸ¥æœºã€‚</li>
<li>å½“å¤šå±‚æ„ŸçŸ¥æœºçš„å±‚æ•°è¾ƒå¤šæ—¶ï¼Œæœ¬èŠ‚çš„å®ç°æ–¹æ³•ä¼šæ˜¾å¾—è¾ƒçƒ¦çï¼Œä¾‹å¦‚åœ¨å®šä¹‰æ¨¡å‹å‚æ•°çš„æ—¶å€™ã€‚</li>
</ul>


<!-- Tags -->



<div class="tags">
    <a href="/tags/MLPåº•å±‚é€»è¾‘-tMXNET/" class="button small">MLPåº•å±‚é€»è¾‘\tMXNET</a>
</div>



<!-- Comments -->
<div>
    
    <hr />
    <h3>Comments:</h3>
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>



</div>



            </div>
        </div>

        <!-- Footer -->
<footer id="footer">
    <div class="inner">
        <section>
            <h2>About</h2>
            <div>
                This blog is used to save the things that I have learnt from Machine Learning and Deep Learning.
            </div>
        </section>
        <section>
            <h2>Follow</h2>
            <ul class="icons">
                
                
                
                
                
                    <li><a href="https://github.com/yeliyang/" class="icon style2 fa-github" target="_blank" ><span class="label">GitHub</span></a></li>
                
                
                
                
                
                    <li><a href="\#" class="icon style2 fa-envelope-o" target="_blank" ><span class="label">Email</span></a></li>
                
                
                    <li><a href="\#" class="icon style2 fa-rss" target="_blank" ><span class="label">RSS</span></a></li>
                
            </ul>
        </section>
        <ul class="copyright">
            <li>&copy; Untitled. All rights reserved</li>
            <li>Design: <a href="http://html5up.net" target="_blank">HTML5 UP</a></li>
            <li>Hexo: <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></li>
        </ul>
    </div>
</footer>
    </div>

    <!-- After footer scripts -->
    
<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- skel -->

<script src="/js/skel.min.js"></script>


<!-- Custom Code -->

<script src="/js/util.js"></script>


<!--[if lte IE 8]>

<script src="/js/ie/respond.min.js"></script>

<![endif]-->

<!-- Custom Code -->

<script src="/js/main.js"></script>


<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'liyang';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


</body>

</html>